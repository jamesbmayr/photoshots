<!DOCTYPE html>
<html>
	<head>
		<script node>getAsset("logo")</script node>
		<script node>getAsset("meta")</script node>
		<script node>getAsset("fonts")</script node>
		<script node>getAsset("css-variables")</script node>
		<link rel="stylesheet" href="game.css"/>
		<script src="qrcode-generator.js" defer></script>
		<script src="game.js" defer></script>
	</head>
	<body>
		<a id="home-link" href="/">home</a>
		<script node>
			if (!REQUEST.game.timeEnd && REQUEST.session.userId && REQUEST.game.players[REQUEST.session.userId]) {
				`<button id="quit-game-button">quit game</button>`
			}
		</script node>
		<script node>
			if (!REQUEST.game.timeEnd && REQUEST.session.userId && REQUEST.game.creatorId == REQUEST.session.userId) {
				`<button id="delete-game-button">delete game</button>`
			}
		</script node>
		<div id="container">
			<h1><script node>REQUEST.game.id</script node></h1>
			<div id="qr-code">
				<h2>QR Code</h2>
				<button id="qr-code-print-button">print QR Code</button>
				<div id="qrcode-container"><script node>REQUEST.game.id</script node></div>
			</div>
			<div id="state">
				<h2>state</h2>
				<div id="state-indicator">
					<h3><script node>REQUEST.game.timeEnd ? "ended" : REQUEST.game.timeStart ? "playing" : "setting up"</script node></h3>
				</div>
				<div id="state-time-start">
					<span>start: </span>
					<span><script node>REQUEST.game.timeStart ? REQUEST.game.timeStart.toLocaleString() : "?"</script node></span>
				</div>
				<div id="state-time-end">
					<span>end: </span>
					<span><script node>REQUEST.game.timeEnd ? REQUEST.game.timeEnd.toLocaleString() : "?"</script node></span>
				</div>
			</div>
			<div id="mode">
				<h2>mode</h2>
				<li id="mode-name"><script node>REQUEST.game.mode.name || "?"</script node></li>
				<li id="mode-win-condition"><script node>REQUEST.game.mode.winCondition || "?"</script node></li>
				<li id="mode-end-condition"><script node>REQUEST.game.mode.endCondition || "?"</script node></li>
			</div>
			<div id="players">
				<h2>players</h2>
				<div id="players-list">
					<script node>
						Object.keys(REQUEST.game.players).map(playerId => {
							const player = REQUEST.game.players[playerId]
							const status = REQUEST.game.timeEnd ? (player.win ? "win" : player.loss ? "loss" : "tie") :
										   !player.connected ? "disconnected" :
										   REQUEST.game.timeStart ? (player.cooldown ? "stunned" : player.target ? "in" : "out") :
										   "ready"
							return `<div class="player">` +
									`<h3>${player.name}</h3>` +
									`<h4>${status}</h4>` +
									`<li class="stat">` +
										`<span>shots</span>` +
										`<span>${player.shots}<span>` +
									`</li>` +
									`<li class="stat">` +
										`<span>stuns</span>` +
										`<span>${player.stuns}<span>` +
									`</li>` +
									`<li class="stat">` +
										`<span>time in</span>` +
										`<span>${player.timeIn}<span>` +
									`</li>` +
									`<li class="stat">` +
										`<span>time out</span>` +
										`<span>${player.timeOut}<span>` +
									`</li>` +
								`</div>`
						}).join(`\n`)
					</script node>
				</div>
			</div>
		</div>
	</body>
</html>
